# Adguard Home

> このページは、[wiki](https://demerara151/setup-new-pc/wiki) に移行しました。docs 内の全てのドキュメントの移行作業が完了次第削除する予定です。

DNS（Domain Name System）をローカルで管理できる通信監理ソフト。Windows ファイアウォールや VPN の代替品、または上位互換。

全ての DNS に関するデータはユーザーの管理下に置かれ、外部に送信されることはありません。ドメイン単位で通信をブロックすることから、DNS ブロッカーとも呼ばれています。

ドメイン単位でのブロックなら、ブラウザの拡張機能 `uBlockOrigin` でもできますが、こちらの `Adguard Home` はブラウザ以外にも PC ソフト、ゲーム、IOT 家電など、インターネットに接続する可能性のある全てのデバイスの通信を一元管理できるというのが大きな利点です。

`Adguard` は様々な料金体系のソフトやアプリを提供していますが、こちらの `Adguard Home` は GPL-3.0 ライセンスの元、オープンソースとして公開されており、利用も改変も自由です。`GitHub` からダウンロードして利用することができます。

## About DNS

> `DNS` について理解している方は読み飛ばしてください。具体的なインストール手順及び実行方法は、[Installation](#installation)から始まります。

通常、インターネットで通信を行う際には目的のパソコン（サーバー）にデータが欲しいというリクエストを送ります。そして相手からデータを渡してもいいよと返事がもらえて初めて、自分のパソコンで内容を閲覧することができます。

このサーバーのインターネット上の住所は `20.27.177.113` のような数字の羅列で表されます。これを「IP アドレス」と呼びます。しかし、「IP アドレス」をいちいち記憶しておくのは大変なため、代わりにそれぞれの「IP アドレス」に「ドメイン名（ホスト名）」として固有の名前を付けることとしました。URL の `https://github.com/demerara151?tab=stars` の `github.com` という部分がそれにあたります。現在では、URL 欄にいちいち「IP アドレス」を入力しなくとも、このように文字列を入力することで目当てのページにアクセスできるようになりました。

「IP アドレス」がインターネット上の住所なら、「ドメイン名」はインターネット上の地名といったところでしょうか。

あなたのパソコンは、あなたが入力した URL からドメイン名を**ドメイン名と IP アドレスの対応表**を持っているパソコン（DNS サーバー）に送信し、その地名（ドメイン名）の住所（IP アドレス）を教えてもらうことで、目的のページにリクエストを送信することができます。

つまり、なんらかの Web サイトをブラウザで開く際には、`DNS` を管理しているサーバーと Web サイトのサーバーの 2 つのパソコンと通信を行っているということになります。あなたがそのページにアクセスしたという情報は、`DNS` の管理者と Web サイトの管理者の両方に知られるということです。もちろん、IP アドレスで直接 Web サイトを開いた場合は、DNS サーバーにデータは送信されないので、`DNS` の管理者にアクセス内容を知られることはありません。

### プライバシーの懸念

この「ドメイン名」と「IP アドレス」を管理している `DNS サーバー` は主に契約している ISP（プロバイダー）が提供しています。その他にも `Microsoft` や `Google`、`CloudFlare` なども、問い合わせの速さやサーバーの安定性を売りにして、独自の DNS サーバーを提供しています。しかし、これらのサーバーはこのサーバーへの「ドメイン名」による「IP アドレス」の問い合わせを記録しています。つまり、誰がいつどこにアクセスしたかが全て把握されてしまいます。各社は利用規約などでこれらの個人情報を利用しない、または追跡しない等の記述をしている場合もありますが、本当のところは定かではありません。

> 特に、日本国内の ISP の DNS サーバーを利用している場合、何らかの事件等が発生した際、全ての記録が警察に提供される可能性があります。これはあなた自身が犯罪を起こしたのでなく、事件とは全く無関係のあなたの PC がサイバー犯罪の踏み台にされたような場合でもあなたのプライバシーが警察に筒抜けになるということです。

`Adguard Home` では、自身のパソコンにこの DNS サーバーを設定することができます。つまり、外部にアクセス内容を送信することがないため、プライバシーが守られます。外部のパソコンにリクエストを送信する前に、ドメイン名の問い合わせの段階でアクセスをブロックしてくれます。

## Installation

参考：[How to install program manually](https://github.com/AdguardTeam/AdGuardHome/wiki/Getting-Started)

[Releases](https://github.com/AdguardTeam/AdGuardHome/releases/latest) から圧縮ファイル `AdGuardHome_windows_amd64.zip` をダウンロードしてきて、任意の場所に展開します。

## Getting Started

まず初めに、Powershell かコマンドプロンプトで `AdguardHome.exe` を管理者権限で起動します。

```Powershell
cd AdguardHome
sudo .\AdGuardHome.exe

```

ここで表示されるポートナンバー `3000` のアドレスを開くと、初期設定が始まります。（例：127.0.0.1:3000）

案内に従って設定を終えたら、コントロールパネルを開いてネットワークの設定画面で、`DNS` の値を現在開いている `LocalHost` の `IP` アドレスに設定します。（例：127.0.0.1 と 192.168.1.1 など）

## Register as service

次に、Adguard Home をサービスに登録します。

```Powershell
sudo .\AdGuardHome -s install

```

## ダッシュボード（管理ページ）

これでセットアップは完了です。

次に、普段統計データを確認したり、追加の設定をしたりするための管理ページである、ダッシュボードを開いてみましょう。

ブラウザで、`localhost` のポートナンバー `80` にアクセスします。（例：127.0.0.1:80）

すると、画面に統計データが表示されると思います。これがメインの管理ページになります。

### フィルタ設定

フィルタは、基本的に `uBlockOrigin` で利用している追加フィルタと同じものを設定すればいいです

ただし、こちらはドメイン名やホスト名で書かれたリストを利用してください。Adguard Home で利用可能なフィルタの検索は、[FilterLists](https://filterlists.com/) を利用すると簡単です

管理ページで、フィルタ -> `DNS` ブロックリストを選択し、手動でフィルタへのリンクを追加します

### クエリ・ログ

ここで、全てのログが確認できます。個別にブロックしたり解除したりできます。

各クエリのレコードの右端の空欄にカーソルをもっていくと、ブロックの項目が現れます。すでにブロック済みの場合は、解除ボタンが表示されます。

ここで、ブロックしたり解除したものは、フィルタ設定の「カスタム・フィルタリングルール」の一覧に自動で追加されます。もちろん、ここに手動で書き込んでも大丈夫です。

### サービス単位でのブロック

フィルタ設定の項目に「ブロックするサービス」というものがあります。

ここでは、サービス単位でアクセスを禁止することができます。

たとえば、`facebook` をブロックすると、テレメトリー等関係なく全ての `facebook` に関連するドメインへのアクセスがブロックされます。`facebook` の場合は、`meta` ドメインも含まれます。

注意：`Amazon` や `CloudFlare` をブロックすると、`AWS` のようなホスティングサービスや コンテンツを配信する `CDN` 等もブロックされ、多くのサービスが利用できなくなる可能性があります。自身が利用しているサービスにこれらが含まれていないか確認してからブロックするか、万が一意図せずしてブロックされてしまった場合は、ログからブロックされたレコードを探して解除してください。

## トラブルシューティング

- ブロックされているわけでもないのにアクセスできないサイトがある

  この場合に考えられるのは、該当するサイトのドメインが `Adguard Home` の DNS サーバーに登録されていないということです。そのため、ログにも残りません。ブラウザでそのサイトを開こうとした場合は、「ホスト名が解決できませんでした」といった類のエラーが出ていることと思います。この場合は、`Adguard Home` のサービスを一時的に止めて、デフォルトの ISP が提供する DNS サーバーを使うか、サードパーティーの DNS サーバーを利用するしかありません。ダッシュボードから「保護を無効にする」をクリックすることでサービスを止めることができます。右側のドロップダウンから時間を指定してその間だけサービスを止めるといったこともできます。

## Appendix

追加情報

### Public DNS Address

Adguard Home の公開 DNS サーバーのアドレスです

上記の手順で、インストールや設定等をせずとも、Windows のコントロールパネルから DNS 設定を書き換えるだけで使えます

ただし、フィルターやブロックするドメイン等を細かく指定することはできません。デフォルトのブロックリストに従うことになります

詳しい設定方法は、[パブリック AdGuard DNS サーバーに接続する方法 | AdGuard DNS](https://adguard-dns.io/ja/public-dns.html) の方法 2 を参照してください

#### Default server for IPv4

- 94.140.14.14
- 94.140.15.15
